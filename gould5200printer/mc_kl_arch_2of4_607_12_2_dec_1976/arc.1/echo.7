R0=%0
R1=%1
R2=%2
R3=%3
R4=%4
R5=%5
SP=%6
PC=%7

TKS=175610
TKB=TKS+2
TPS=177564
TPB=177566
.=2000

START:	RESET
	CLR TWOFLG
	CLR CNTFLG
	CLR RUBOUT
	CLR RUBOT1
	MOV #BUF1,R1
	MOV #BUF1,R2
	MOV #1,FINFLG
	MOV #START,SP

LOOP1:	TSTB TKS
	BPL LOOP
	MOV TKB,(R1)+
	BPL 3$
	HALT
3$:	BR LOOP1
LOOP:	TST FINFLG
	BEQ LOOP2
	CMP R1,R2
	BEQ LOOP1
	MOV (R2)+,R0
	CLR FINFLG
	BIT #200,R0
	BEQ 1$
	BIC #200,R0
	INC TWOFLG
1$:	BIT #140,R0
	BNE 2$
	BIS #100,R0
	INC CNTFLG
2$:	CMPB #177,R0
	BNE LOOP2
	INC RUBOUT
	INC RUBOT1

LOOP2:	TSTB TPS
	BPL LOOP1
	TST TWOFLG
	BEQ 1$
	MOV #115,TPB
	CLR TWOFLG
	BR LOOP2
1$:	TST CNTFLG
	BEQ 2$
	MOV #136,TPB
	CLR CNTFLG
	BR LOOP2
2$:	TST RUBOUT
	BEQ 3$
	MOV #77,TPB
	CLR RUBOUT
	BR LOOP2
3$:	TST RUBOT1
	BEQ 4$
	MOV #77,TPB
	CLR RUBOT1
	INC FINFLG
	BR LOOP1
4$:	MOV R0,TPB
	INC FINFLG
	BR LOOP1

TWOFLG:	.WORD 0
CNTFLG:	.WORD 0
RUBOUT:	.WORD 0
RUBOT1:	.WORD 0
FINFLG:	.WORD 0
BUF1:	.BLKW 1000

	.END START
